---
phase: 02-bug-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - utils/backup.ts
  - components/grid-layout/use-grid-stack.tsx
autonomous: true

must_haves:
  truths:
    - 'Importing malformed JSON backup shows error instead of crashing'
    - 'Grid resize operations work without errors (no dead handler)'
  artifacts:
    - path: utils/backup.ts
      provides: 'JSON.parse wrapped in try/catch; returns false on parse failure'
      contains: 'try'
    - path: components/grid-layout/use-grid-stack.tsx
      provides: 'No empty resizecontent handler'
  key_links:
    - from: utils/backup.ts
      to: 'importBackupData'
      via: 'JSON.parse in try block before destructuring'
      pattern: "JSON\\.parse.*try"
---

<objective>
Fix BUGF-02 (JSON.parse safety) and BUGF-03 (dead code removal).

Purpose: Malformed JSON backup files currently throw uncaught SyntaxError; empty resizecontent handler is dead code. Apply targeted fixes per RESEARCH.
Output: backup.ts with try/catch around JSON.parse; use-grid-stack.tsx with resizecontent handler removed.
</objective>

<execution_context>
@/home/whj/.claude/get-shit-done/workflows/execute-plan.md
@/home/whj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-bug-fixes/02-RESEARCH.md
@utils/backup.ts
@components/grid-layout/use-grid-stack.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wrap JSON.parse in try/catch (BUGF-02)</name>
  <files>utils/backup.ts</files>
  <action>
In `importBackupData`, move `JSON.parse(text)` inside a try block. Current code destructures `const { gridItems } = JSON.parse(text)` before the try — parse errors escape. Fix:
1. Add `let data: BackupData` before try
2. In try block: `data = JSON.parse(text) as BackupData`
3. On catch: `console.error('[备份]: JSON 解析失败', text.slice(0, 100))` and `return false`
4. Use `data.gridItems` in the existing DB try block
Do NOT add schema validation (that's BKUP-02 in Phase 3).
  </action>
  <verify>
- Malformed JSON file (e.g. `{invalid`) passed to importBackupData returns false, logs error, does not throw
- Valid JSON with gridItems imports successfully
  </verify>
  <done>Malformed JSON returns false with logged error; valid backup imports successfully</done>
</task>

<task type="auto">
  <name>Task 2: Remove empty resizecontent handler (BUGF-03)</name>
  <files>components/grid-layout/use-grid-stack.tsx</files>
  <action>
Remove the empty `resizecontent` event handler (lines 118-121 in current file):
```ts
grid.on(
  'resizecontent',
  throttle((ev, items) => {}, 300)
)
```
The handler does nothing; GridStack has `disableResize: true` so it's dead code. Delete the entire block. If `throttle` becomes unused, remove its import.
  </action>
  <verify>
- No `resizecontent` handler in use-grid-stack.tsx
- `npm run build` or `npm run dev:web` succeeds
  </verify>
  <done>Empty resizecontent handler removed; grid layout works without errors</done>
</task>

</tasks>

<verification>
- Backup import handles malformed JSON gracefully
- No dead resizecontent handler; build passes
</verification>

<success_criteria>
BUGF-02 and BUGF-03 resolved: Import errors caught; dead code removed
</success_criteria>

<output>
After completion, create `.planning/phases/02-bug-fixes/02-02-SUMMARY.md`
</output>
