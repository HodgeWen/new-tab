---
phase: 01-policy-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/searcher/searcher.vue
autonomous: true
must_haves:
  truths:
    - "User can search via search bar and results use browser's default search engine (chrome.search API)"
  artifacts:
    - path: components/searcher/searcher.vue
      provides: "Search bar with chrome.search.query"
      contains: "chrome.search.query"
  key_links:
    - from: components/searcher/searcher.vue
      to: chrome.search API
      via: handleSearch calling chrome.search.query
      pattern: "chrome\\.search\\.query"
---

<objective>
Replace hardcoded Google search URL with chrome.search.query() in the search bar to comply with Chrome Web Store NTP policy (PLCY-01).

Purpose: Chrome policy requires NTP extensions with search to use the Search API so results respect the user's default search engine.
Output: Modified searcher.vue that uses chrome.search.query() in extension context and falls back for dev:web.
</objective>

<execution_context>
@/home/whj/.claude/get-shit-done/workflows/execute-plan.md
@/home/whj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-policy-compliance/01-RESEARCH.md
@components/searcher/searcher.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace search redirect with chrome.search.query</name>
  <files>components/searcher/searcher.vue</files>
  <action>
In handleSearch(), replace the hardcoded Google redirect with:

1. Guard: if `typeof chrome !== 'undefined' && chrome.search?.query` exists, call:
   `chrome.search.query({ text: query.value.trim(), disposition: 'CURRENT_TAB' })`
2. Fallback: when chrome.search is unavailable (dev:web mode), use:
   `window.location.href = \`https://www.google.com/search?q=${encodeURIComponent(query.value)}\``

Keep the existing `if (!query.value.trim()) return` guard at the start.

Remove the Chinese comment "使用谷歌搜索" (or replace with a brief comment about extension vs dev fallback).

Reference: 01-RESEARCH.md Pattern 1 and Pitfall 1.
  </action>
  <verify>
1. Run `pnpm dev` (or `npx wxt dev`), load extension in Chrome, open new tab, type query in search bar, press Enter → search uses default engine (or Google if default).
2. Run `pnpm dev:web`, open localhost, type query, press Enter → navigates to Google search (fallback).
  </verify>
  <done>
Valid search query submitted via search bar triggers chrome.search.query() in extension context; dev:web fallback navigates to Google.
  </done>
</task>

</tasks>

<verification>
- Extension mode: Search bar uses chrome.search.query (no hardcoded engine URL)
- dev:web mode: Search still works via fallback
- No new dependencies or permissions required (search permission already declared)
</verification>

<success_criteria>
PLCY-01 satisfied: Search bar uses chrome.search.query() in extension context; user's default search engine is respected.
</success_criteria>

<output>
After completion, create `.planning/phases/01-policy-compliance/01-01-SUMMARY.md`
</output>
