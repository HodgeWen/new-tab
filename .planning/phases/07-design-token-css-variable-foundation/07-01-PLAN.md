---
phase: 07-design-token-css-variable-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - entrypoints/newtab/styles/variables.css
  - components/grid-layout/use-grid-stack.tsx
  - components/grid-layout/grid-layout.vue
autonomous: true
requirements: [VSTL-04, VSTL-05, GRID-01]

must_haves:
  truths:
    - "New size tokens (--size-icon-sm/md/lg, --size-input-height) exist in variables.css across all three theme blocks where needed"
    - "GridStack configuration uses named SCREAMING_SNAKE_CASE constants instead of magic numbers"
    - "grid-layout.vue contains no commented-out dead style code"
    - "No unused CSS variables remain in variables.css"
  artifacts:
    - path: "entrypoints/newtab/styles/variables.css"
      provides: "New design tokens for sizes, overlay, glass-bg-subtle, color-on-primary"
      contains: "--size-icon-sm"
    - path: "components/grid-layout/use-grid-stack.tsx"
      provides: "Named GridStack configuration constants"
      contains: "GRID_CELL_HEIGHT"
    - path: "components/grid-layout/grid-layout.vue"
      provides: "Clean style block without dead commented code"
  key_links:
    - from: "entrypoints/newtab/styles/variables.css"
      to: "all component .vue files"
      via: "CSS custom property inheritance"
      pattern: "--size-icon-|--glass-bg-subtle|--overlay-bg|--color-on-primary"
    - from: "components/grid-layout/use-grid-stack.tsx"
      to: "GridStack.init()"
      via: "named constants passed to init config"
      pattern: "GRID_CELL_HEIGHT|GRID_MARGIN|GRID_COLUMN_WIDTH"
---

<objective>
Define new design tokens in variables.css, extract GridStack magic numbers to named constants, and clean dead code from grid-layout.vue.

Purpose: Establish the token foundation that Plans 02 and 03 depend on — all new CSS variables must exist before components can reference them.
Output: Updated variables.css with new tokens, use-grid-stack.tsx with named constants, clean grid-layout.vue.
</objective>

<execution_context>
@/home/whj/.claude/get-shit-done/workflows/execute-plan.md
@/home/whj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@entrypoints/newtab/styles/variables.css
@components/grid-layout/use-grid-stack.tsx
@components/grid-layout/grid-layout.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add new design tokens to variables.css</name>
  <files>entrypoints/newtab/styles/variables.css</files>
  <action>
Add the following new tokens to variables.css. Place them logically within the existing structure.

**In `:root` block — add a new "尺寸 / Sizes" section after the "字重 / Font Weights" section:**
```css
/* === 尺寸 / Sizes === */
--size-icon-sm: 16px;
--size-icon-md: 20px;
--size-icon-lg: 24px;
--size-input-height: 40px;
```

**In `:root` block — add to the "玻璃效果 / Glass Effect" section, after `--glass-bg-active`:**
```css
--glass-bg-subtle: rgba(255, 255, 255, 0.1);
```

**In `:root` block — add a new "覆盖层 / Overlay" section after the "渐变 / Gradients" section:**
```css
/* === 覆盖层 / Overlay === */
--overlay-bg: rgba(0, 0, 0, 0.4);
```

**In `:root` block — add to the "功能色 / Functional Colors" section, after `--color-warning-subtle`:**
```css
--color-on-primary: #ffffff;
```

**In `[data-theme="dark-wallpaper"]` block — add after `--glass-bg-active`:**
```css
--glass-bg-subtle: rgba(0, 0, 0, 0.30);
```

**In `[data-theme="light-wallpaper"]` block — add after `--glass-bg-active`:**
```css
--glass-bg-subtle: rgba(255, 255, 255, 0.65);
```

Size tokens (--size-*), --overlay-bg, and --color-on-primary are theme-invariant — only define in :root.

**Additionally:** Grep all defined CSS custom properties in variables.css and search for usages across the entire codebase (*.vue, *.css, *.ts, *.tsx). Remove any variables that are defined but never referenced anywhere outside variables.css itself. Document which (if any) were removed.
  </action>
  <verify>
Grep variables.css for the new token names: `--size-icon-sm`, `--glass-bg-subtle`, `--overlay-bg`, `--color-on-primary`. All must be present. Verify `--glass-bg-subtle` appears in all three theme blocks (:root, dark-wallpaper, light-wallpaper). Run `npx vue-tsc --noEmit` to confirm no type errors.
  </verify>
  <done>
New tokens --size-icon-sm/md/lg, --size-input-height, --glass-bg-subtle (3 themes), --overlay-bg, and --color-on-primary are defined in variables.css. No unused variables remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract GridStack constants and clean grid-layout dead code</name>
  <files>
    components/grid-layout/use-grid-stack.tsx
    components/grid-layout/grid-layout.vue
  </files>
  <action>
**use-grid-stack.tsx:** At the top of the file (after imports, before the composable function), add named constants:
```typescript
const GRID_CELL_HEIGHT = 64
const GRID_MARGIN = 4
const GRID_COLUMN_WIDTH = 60
const GRID_COLUMN_MAX = 24
```

Then replace the magic numbers in `GridStack.init()` call:
```typescript
grid = GridStack.init(
  {
    cellHeight: GRID_CELL_HEIGHT,
    margin: GRID_MARGIN,
    animate: false,
    disableResize: true,
    columnOpts: { columnWidth: GRID_COLUMN_WIDTH, columnMax: GRID_COLUMN_MAX, layout: 'compact' }
  },
  gridContainer.value
)
```

**grid-layout.vue:** Remove the commented-out dead style block (the `.grid-stack-placeholder` section, approximately lines 56-62):
```css
/* .grid-stack-placeholder > .placeholder-content {
  border: 2px dashed var(--glass-border-strong, rgba(255, 255, 255, 0.2));
  border-radius: var(--radius-md, 12px);
  background: var(--glass-bg, rgba(255, 255, 255, 0.08));
  backdrop-filter: blur(8px);
} */
```

Also scan for any other dead/commented-out code blocks in use-grid-stack.tsx and grid-layout.vue — clean them if found.
  </action>
  <verify>
Grep use-grid-stack.tsx for `GRID_CELL_HEIGHT` (must exist) and for bare `cellHeight: 64` (must NOT exist). Grep grid-layout.vue for `grid-stack-placeholder` (must NOT exist). Run `npx vue-tsc --noEmit` to confirm no type errors.
  </verify>
  <done>
GridStack.init() uses GRID_CELL_HEIGHT, GRID_MARGIN, GRID_COLUMN_WIDTH, GRID_COLUMN_MAX constants. grid-layout.vue has no commented-out style blocks.
  </done>
</task>

</tasks>

<verification>
1. `grep -c 'size-icon-sm\|glass-bg-subtle\|overlay-bg\|color-on-primary' entrypoints/newtab/styles/variables.css` returns ≥4
2. `grep 'GRID_CELL_HEIGHT' components/grid-layout/use-grid-stack.tsx` returns matches
3. `grep 'placeholder' components/grid-layout/grid-layout.vue` returns 0 matches
4. `npx vue-tsc --noEmit` passes
</verification>

<success_criteria>
- New design tokens are defined and theme-aware
- GridStack uses named constants
- No dead code in grid-layout styles
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/07-design-token-css-variable-foundation/07-01-SUMMARY.md`
</output>
